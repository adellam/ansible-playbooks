---
- block:

    - name: Remove the old smart executor files if present
      file: path={{ smartgears_instance_path }}/webapps/{{ smart_executor_name }} state=absent
      when: ( not smart_executor_install ) or ( smartgears_upgrade )

    - name: Remove the old fhn-manager files
      file: path={{ smartgears_instance_path }}/webapps/{{ fhn_manager_name }} state=absent
      when: ( remove_fhn_manager_install ) or ( smartgears_upgrade )

  
    # NOTE: Install as the smartgears user so we do not mess with the permissions
    - name: Get the fhn-manager-service 
      get_url: url={{ fhn_manager_url }} dest={{ smartgears_user_home }}/{{ fhn_manager_file }}
      when: fhn_manager_install
  
    - name: Create the fhn manager  working directory
      file: path={{ smartgears_instance_path }}/webapps/{{ fhn_manager_name }} state=directory owner={{ smartgears_user }} group={{ smartgears_user }}
      when: fhn_manager_install
  
    - name: Unarchive the fhn_manager war
      unarchive: copy=no src={{ smartgears_user_home }}/{{ fhn_manager_file }} dest={{ smartgears_instance_path }}/webapps/{{ fhn_manager_name }} creates={{ smartgears_instance_path }}/webapps/{{ fhn_manager_name }}/WEB-INF/lib
      when: fhn_manager_install
      notify: Restart smartgears

  become: True
  become_user: '{{ d4science_user }}'
  tags: [ 'smartgears', 'fhn_manager', 'tomcat' ]
